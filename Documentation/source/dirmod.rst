Directory and Hardware Modification
===================================
This page covers the basic description of the repository's directory and how to modify the hardware design if required.

Directory
^^^^^^^^^
The directory is arranged in 6 folders listed and described below:

- Altium:
    Contains the PCB docs and schematic docs for the level shifter boards.
- Documentation:
    Sphinx makefile to generate documentation
- OnPynq:
    Contains the files that must be transferred to the Pynq.
- Pynq IO Reference:
    Contains an excel file mapping the external interface ports and peripherals such as LEDs to the attached pin on the Zynq.
- PythonClient:
    Contains the client side python code that must be run on a workstation.
- Vivado:
    Contains all Vivado projects and IP Cores created.

Modification of Hardware Design
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
Project explanations
""""""""""""""""""""
The entire hardware design was constructed out of multiple projects that have had IP cores made from them which were used in the main project (TOP_OVERLAY).

A list and description of each project is below:

- CO_AXI_PERIPH:
    Consists of the counter along with the AXI infrastructure required to control it. Has a generated IP core that is directly used in the top overlay project.
- COUNTER_IP:
    Consists of the actual counter, the Ip generated by this project is directly used by CO_AXI_PERIPH.
- DDS_AXI_PERIPH:
    Consists of the signal generator IP core along with the AXI infrastructure required to control it. The generated Ip core from this project is directly used by TOP_OVERLAY.
- DDS_COM_PG:
    Consists of the actual signal generator. The IP generated by this project is used in DDS_AXI_PERIPH.
- DESERIALIZER:
    Consists of both the input delays and ISERDES along with the AXI infrastructure to operate them. The IP generated by this project is used in TOP_OVERLAY.
- High ResolutionMode/SDOS_ST:
    Consists of the actual high resolution mode single channel inter rising edge timer. The IP from this project is used in ST_TEST.
- High ResolutionMode/ST_TEST:
    Consists of the high resolution mode single channel inter rising edge timer along with the Zynq processing system and AXI infrastructure connecting the two. It is a full overlay that is used to configure the FPGA into high resolution mode. This project generates the high resolution mode bit file.
- SDDR_CT and SDDR_CT_AXI:
    SDDR_CT consists of the coincidence timer and its IP is used in SDDR_CT_AXI where it is linked to AXI infrastructure. The IP from this is used in TOP_OVERLAY.
- SDDR_ST and SDDR_ST_AXI:
    SDDR_ST consists of the coincidence timer and its IP is used in SDDR_ST_AXIwhere it is linked to AXI infrastructure. The IP from this is used in TOP_OVERLAY.
- SDDR_TT and SDDR_TT_AXI:
    SDDR_TT consists of the coincidence timer and its IP is used in SDDR_TT_AXI where it is linked to AXI infrastructure. The IP from this is used in TOP_OVERLAY.
- TOP_OVERLAY:
    The main overlay of the default mode of the time controller, it consists of all the IP blocks from each project defined above (except the high resolution mode IPs) which are all connected to an AXI interconnect which then connects to the Zynq processing system. This project generates the default overlay's bit file.

Modification
""""""""""""
If any of the individual modules are edited (e.g. SDDR_CT) then the IP block must be exported and added (or upgraded) in the corresponding AXI project (e.g. SDDR_CT_AXI) which then must have its IP block exported and added (or upgraded) in the top overlay project.

If the pin out of the time controller must be edited, one can simply edit the .XDC files in constraints in Vivado, or use he IO planning utility in Vivado which will automatically write the I/O constraints.

After running synthesis, implementation and write_bitstream, the .tcl file in the project folder (for TOP_OVERLAY it is ``trfbitstrm.tcl`` must be run, this will automatically generate the block diagram's TCL file and copy the .bit file to the OnPynq directory (the TCL file to do this may require editing if the directory changed)).
